<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Michelle L Sculley">
<meta name="dcterms.date" content="2023-04-01">

<title>A Preliminary Base-case model in SS3.30 for the 2023 North Pacific Swordfish Assessment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="Sculley_AssessmentWP_files/libs/clipboard/clipboard.min.js"></script>
<script src="Sculley_AssessmentWP_files/libs/quarto-html/quarto.js"></script>
<script src="Sculley_AssessmentWP_files/libs/quarto-html/popper.min.js"></script>
<script src="Sculley_AssessmentWP_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Sculley_AssessmentWP_files/libs/quarto-html/anchor.min.js"></script>
<link href="Sculley_AssessmentWP_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Sculley_AssessmentWP_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Sculley_AssessmentWP_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Sculley_AssessmentWP_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Sculley_AssessmentWP_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A Preliminary Base-case model in SS3.30 for the 2023 North Pacific Swordfish Assessment</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Michelle L Sculley </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 1, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="a-preliminary-base-case-model-in-ss3.30-for-the-2023-north-pacific-swordfish-assessment" class="level1">
<h1>A preliminary base-case model in SS3.30 for the 2023 North Pacific Swordfish Assessment</h1>
<p>Michelle L. Sculley,* Yi-Jay Chang,<sup>+</sup> Hirotaka Ijima<sup>^</sup></p>
<p>*NOAA NMFS Pacific Islands Fisheries Science Center, Honolulu, HI</p>
<p>michelle.sculley@noaa.gov</p>
<p><sup>+</sup>National Taiwan University, Taipei, Taiwan</p>
<p><sup>^</sup>Fisheries Research Agency, Yokohama, Japan</p>
</section>
<section id="abstract" class="level1">
<h1>Abstract</h1>
<p>A preliminary base-case model in Stock Synthesis 3.30 for North Pacific (NP) swordfish (<em>Xiphias gladius</em>) is described for consideration as the 2023 base-case model. The base-case model covers the Western and Central North Pacific north of the Equator and the Eastern Pacific Ocean north of 10°N from 1975 to 2021. It includes data from three International Scientific Committee for the Conservation of Tuna and Tuna-like Species (ISC) countries and other countries in aggregate from the Western and Central Pacific Fisheries Commission (WCPFC) and the Inter-American Tropical Tuna Commission (IATTC). This paper describes the data available for inclusion and the proposed base-case model. The model converges and appears to fit the data well. Initial diagnostics do not indicate major problems. Preliminary results suggest the North Pacific swordfish stock is being not fished above F<sub>MSY</sub> and spawning stock biomass is above SSB<sub>MSY</sub>.</p>
</section>
<section id="introduction" class="level1">
<h1>5Introduction</h1>
<p>The International Scientific Committee for the Conservation of Tuna and Tuna-like Species (ISC) Billfish Working Group (BILLWG) has proposed to run a benchmark assessment on North Pacific swordfish (<em>Xiphias gladius,</em> SWO). Data were compiled from the International Scientific Committee for North Pacific Tuna and Tuna-like Species (ISC) member countries and other Western and Central Pacific Fisheries Commission (WCPFC) and Inter-American Tropical Tuna Commission (IATTC) countries. Countries were asked to contribute catch, CPUE, and size-frequency data. It was decided to run the assessment using a sex-specific model in Stock Synthesis version 3.30.20 (Methot and Wetzel, 2013) with fleets-as-areas spearating the Eastern Pacific Ocean (EPO) region from the Western and Central North Pacific (WCNPO) region, as defined in the December 2022 BILLWG meeting. The available data and the preliminary model results and diagnostics for a base-case model will be presented in this document for consideration at the ISC BILLWG SWO stock assessment meeting.</p>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="spatial-temporal-structure" class="level2">
<h2 class="anchored" data-anchor-id="spatial-temporal-structure">Spatial Temporal Structure</h2>
<p>Data were compiled by region assuming a two region model of the North Pacific Ocean with boundaries based upon those detailed in Ichinokawa and Brodziak (2008) with the modification that the Eastern Pacific Ocean (EPO) region ends at 10°N (<a href="#fig-1">Figure&nbsp;1</a>). Countries were asked to contribute catch, CPUE, and length frequency data partitioned by these two regions so that the North Pacific could be modeled with two implicit areas using fleets as areas. The working group agreed to start model in 1975.</p>
<div id="fig-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2023_SWO_stock_boundary.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Western and Central North Pacific Ocean and North Eastern Pacific Ocean swordfish stock boundaries for the 2023 North Pacific swordfish assessment. Spatial structure is treated implicitly using fleets as areas.</figcaption><p></p>
</figure>
</div>
</section>
<section id="definition-of-fisheries" class="level2">
<h2 class="anchored" data-anchor-id="definition-of-fisheries">Definition of Fisheries</h2>
<p>Data are available for fourteen different fleets in the WCNPO: 14 catch time series, with some fleets split into early and late periods and 8 CPUE indices of which one is a recruitment index. The fleet names and numbers are detailed in Table 1. The data available for each fleet is in <a href="#fig-2">Figure&nbsp;2</a>. The acronyms in the fleet names are defined as follows: WCNPO is Western and Central North Pacific Ocean; EPO is Eastern Pacific Ocean; OSDWLL is offshore distant water longline; OSDWCOLL is offshore distant water and coastal longline; early is the early time period; late is the late time period, Area1 and 2 are the Japanese fishery areas in the WCNPO as defined in Ijima 2022; OSDF is offshore driftnet gear; CODF is coastal driftnet gear, JPN_WCNPO_Other is Japanese small-scale coastal longline vessels which are not under obligation to submit logbook data, bait, and net fishing gear; DWLL is distant water longline gear, TWN_WCNPO_Other is Taiwanese offshore longline, coastal longline, gillnet, harpoon and other gears; LL is longline gear; shallow is the Hawaii shallow-set sector; deep is the Hawaii deep-set sector; GN is gillnet gear; US_WCNPO_Other is harpoon and other gears; WCPFC is other WCPFC and IATTC longline gear in the WCNPO; IATTC is longline gear in the EPO north of 10ºN.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Sculley_AssessmentWP_files/figure-html/fig-2-1.png" class="img-fluid figure-img" width="1536"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Catch, CPUE index, and size composition data included in the 2023 NP swordfish stock assessment. The size of the bubble indicates the relative number of observations available.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="catch" class="level2">
<h2 class="anchored" data-anchor-id="catch">Catch</h2>
<p>Some of the time series of catch were divided into early and late periods to coincide with divisions of the CPUE indices (Table 1, <a href="#fig-3">Figure&nbsp;3</a>). Three ISC countries contributed catch time series: Japan, Taiwan, and the US. In addition, catch from countries reporting to the WCPFC and IATTC were obtained from each RFMO, respectively. The CV for catch was set to 0.05 for all fleets. Catch for fleets with only annual data were divided equally into each quarter.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Sculley_AssessmentWP_files/figure-html/fig-3-1.png" class="img-fluid figure-img" width="1152"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Annual catch of NP swordfish by country or commission and area.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="relative-abundance-indices" class="level2">
<h2 class="anchored" data-anchor-id="relative-abundance-indices">Relative Abundance Indices</h2>
<p>Each of the eight CPUE time series were assigned to a quarter based upon the recommendations of the country providing the index and are assumed to represent the quarter in which the highest catches take place for each fishery. Japanese longline fleets (S1-4) were all assigned to quarter 1; Taiwanese longline fleet (S5) was assigned to quarter 3; US longline deep-set (S7) was assigned to quarter 2, and US longline shallow-set (S8 and S9) were assigned to quarter 1. US longline deep-set fleet S6 was included as an index of recruitment because the fishery catches large numbers of young-of-the-year fish (Fleet type 31, Bohaboy and Sculley, 2023). The CPUE indices were assumed to be linearly proportional to biomass where catchability (<em>q</em>) was assumed to be constant and occur in the first month of the quarter assigned.</p>
<p>The CVs for each CPUE index were assumed to be equal to their respective calculated SEs on the log scale. The minimum CV was scaled to a minimum of 0.20 or the root-mean-square error (RMSE) (i.e., square root of the residual variance) of what we would expect the assessment model to fit the CPUE index best by adding a constant to each CV value. This was calculated as the square root of the residual variance of a loess smoother fit to each index (Francis 2011, Lee et al., 2014).</p>
<p><span class="math display">\[RSME_{smoother} = \sqrt{(1/N)\sum_{t=1}^{N}(Y_{t}-\hat{Y_{t}})}\]</span></p>
<p>where <em>Y</em><sub>t</sub> is the observed CPUE in year <em>t</em> on the log scale, <span class="math inline">\(\hat{Y}\)</span> is the predicted CPUE in year <em>t</em> from the smoother fit to the data on the log scale, and <em>N</em> is the number of CPUE observations. RMSE values for each index are listed in Table 2. If the input SE was greater than these values, it was left unchanged.</p>
</section>
<section id="length-composition" class="level2">
<h2 class="anchored" data-anchor-id="length-composition">Length Composition</h2>
<p>Length composition data were available for six WCNPO fleets and two EPO fleets (<a href="#fig-4">Figure&nbsp;4</a>). Length composition data were available in quarterly time steps. Quarters with fewer than 15 total samples were removed from the time series due to limited sample size, as agreed upon by the modeling sub-group. In addition, the length composition data for F5 were excluded as they were sparse. Data were fit using a multinomial error structure. Length composition data were weighted based upon the Francis (2011) method. Input effective sample size was estimated as the total number of fish measured in each year-quarter divided by 10, with any year-quarter over fifty set to fifty to reduce the influence of large sampling events. Then, weighting was attempted based upon the T.A1.8 equation (Francis 2011) as calculated by the model using r4ss, an R package for plotting SS results (R version 3.4.0, R Core Team, 2017, r4ss version 1.28.0, Taylor et al., 2017). Length composition data were only down-weighted if the model suggested it, otherwise the fleets were not adjusted. The only fleet to be down-weighted using the Francis methods was F9, the US deep-set LL data.</p>
<div id="fig-4" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lendat__page1_multi-fleet_comparison.png" class="img-fluid figure-img"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lendat__page2_multi-fleet_comparison.png" class="img-fluid figure-img" width="674"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: Length Composition data available in 5cm size bins for the 2023 NP swordfish stock assessment.</figcaption><p></p>
</figure>
</div>
</section>
<section id="initial-base-case-model-description" class="level2">
<h2 class="anchored" data-anchor-id="initial-base-case-model-description">Initial Base-case Model Description</h2>
<p>The assessment was conducted with Stock Synthesis (SS) version 3.30.20.00 released 09/30/2022 using Otter Research ADMB 13.0 (Methot and Wetzel 2013). The model was set up as a single area model with two sexes and four seasons (quarters) with fleets as areas. Spawning was assumed to occur in May (month 5) while recruitment was assumed to occur in July (month 7). Age at recruitment was calculated based upon the model estimated average selectivity at age based upon the quarterly selectivity at length. The maximum age of swordfish was set to 15 years. Sex specific biological parameters were used, with sex- and age-specific natural mortality (Table 3) as agreed upon in the BILLWG data preparatory meeting (ISC Billfish WG 2023). In addition, the CV of the growth curve was set to 0.1 for small males and females and 0.15 for large males and females, and the sex ratio at birth was assumed to be 1:1. The model used a Beverton-Holt spawner-recruit relationship with steepness (h) fixed at 0.9 and sigmaR (σ<sub>r</sub>) initially fixed at 0.6 and rescaled to 0.42 based upon the model suggestion.</p>
<p>Twenty-seven fleets were included in the model: 19 catch fleets and 8 survey fleets. Initial equilibrium catch was estimated for 1974.</p>
<p>Main recruitment deviations were estimated from 1985-2021, as this is the period during which there are size composition data. The recruitment deviations were bias-adjusted based upon the estimates from Methot and Taylor (2011) provided from the model results. No bias adjustment was applied to recruitment deviations from 1965-1967. 1967-1995 was the “ramp-up” period where the bias adjustment of σ<sub>r</sub> was 0 at the beginning of the period and increased linearly to the maximum bias adjustment 0.94 in 1995. Full bias adjustment was from 1995-2021. The early period of recruitment deviations represents a data-poor period where there is little information to drive recruitment. The main recruitment period represents a data-rich period where there is enough data to drive the bias-adjustment of the recruitments. The ramp up period allows for a gradual ramp up of the bias-adjustment between the data-poor and data-rich periods.</p>
<p>The population model and the fishery length data had 51 five cm length bins from 10-260+ cm. The population had 16 annual ages from age 0 to 15+. There were no age data. Fishery length data were used to estimate selectivity patterns which controlled the size distribution of the fishery removals. All fleets with length data were estimated as six parameter double normal (dome-shaped) selectivity patterns. Survey selectivity patterns mirrored their respective catch fleets (Table 4). Estimating parameters six of the double normal selectivity pattern for F9 resulted in an improved fit to the size composition data for that fleet.</p>
<p>Model estimated time series of total biomass (B in metric tons, mt = 1000 kg), age 1+ total biomass (B<sub>1+</sub> mt), female spawning biomass (SSB mt) and recruitment (R in 1000s of fish) were tabulated on an annual basis. Annual exploitation rate (F) was calculated as Catch/B<sub>1+</sub>. Stock status indicators were calculated based upon MSY-based reference points as proxies, given that the WCPFC has not set biological or other reference points for swordfish.</p>
</section>
<section id="convergence-criteria-and-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="convergence-criteria-and-diagnostics">Convergence Criteria and Diagnostics</h2>
<p>The model was assumed to have converged if the standard error of the estimated parameters could be derived from the inverse of the negative hessian matrix. Various convergence diagnostics were also evaluated. Excessive CVs (&gt;50%) on estimated parameters would suggest uncertainty in the parameter estimates or model structure. A gradient of &gt;0.001 would suggest poorly fit parameter estimates. The correlation matrix was also evaluated to identify highly correlated (&gt;95%) and non-informative (&lt;0.01) parameters. Parameter estimates hitting bounds of the prior was also indicative of poor model fit.</p>
<p>Several diagnostics were run to evaluate the fit of the model to the data. An Age-Structure Population Model (APSM) was used to evaluate the influence of the length composition data on the population trends (Carvalho <em>et al.</em>, 2017). The ASPM was also used to explore how each CPUE index informed the population trends by running one-off ASPMs for each index. Profiling the likelihood on R<sub>0</sub>, where the R<sub>0</sub> is fixed at a range of values around the maximum likelihood estimate and then the likelihood is estimated, was used to identify influential data components (Lee <em>et al.,</em> 2014). A runs test was used to evaluate randomness in the residuals of the CPUE data (Carvalho <em>et al.,</em> 2021). Residual plots and plots of the observed vs expected data were examined to evaluate goodness-of-fit. Finally, a retrospective analysis and hindecast cross-validation were used to evaluate the predictive ability of the model (Carvalho <em>et al.,</em> 2021).</p>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="model-fit" class="level2">
<h2 class="anchored" data-anchor-id="model-fit">Model fit</h2>
<p>The base-case model ran in about 10 minutes, estimated 89 parameters, and had a total likelihood of 1338.75 The inverse Hessian was positive definite, which allowed for the estimation of parameter standard deviations and suggests that the model converged, and the maximum gradient component was less than 0.001. None of the parameter estimates hit a bound, two selectivity parameters had a correlation above 0.95 and no parameters had correlations below 0.01. All twenty early recruitment deviations (1965-1984) and 30 of the 37 main recruitment deviations had CVs &gt; 50%. Five of the 34 selectivity parameters had CVs &gt;50%, most of which were for the estimated width of the peak (i.e.&nbsp;a very small number).</p>
<p>Fits to the abundance indices were relatively good (<a href="#fig-5">Figure&nbsp;5</a> - <a href="#fig-12">Figure&nbsp;12</a>). The expected CPUE trend for S5 TWN LL was relatively flat and did not fit the data well, and the observed CPUE in the last 3-5 years for S4 JPN LL area 1 declined but the expected CPUE increased. Three indices failed the runs test, S5, S6, and S8 (Figure 11). S6 is the US deep set LL fleet which is a recruitment index and not fitted as a survey index, so its fit can be ignored. S8 is the US shallow-set LL fleet in the late time period, and indicates a long term decline. Additional investigation into the CPUE indices indicate that there does appear to be some conflict between the trends for each fleet, which could be driving some of the mis-fit within the model.</p>
<div id="fig-5" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index5_logcpuefit_S1_JPN_WCNPO_OSDWLL_early_Area1.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index10_resids_SE_total_S1_JPN_WCNPO_OSDWLL_early_Area1.png" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;5: Fit to the S1 Japanese early area 1 LL CPUE index. Left is the input CPUE with CV and the model fit CPUE (blue line). Right is the annual residuals of that fit.</figcaption><p></p>
</figure>
</div>
<div id="fig-6" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index5_logcpuefit_S2_JPN_WCNPO_OSDWCOLL_late_Area1.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index10_resids_SE_total_S2_JPN_WCNPO_OSDWCOLL_late_Area1.png" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;6: Fit to the S2 Japanese late area 1 LL CPUE index. Left is the input CPUE with CV and the model fit CPUE (blue line). Right is the annual residuals of that fit.</figcaption><p></p>
</figure>
</div>
<div id="fig-7" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index5_logcpuefit_S3_JPN_WCNPO_OSDWLL_early_Area2.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index10_resids_SE_total_S3_JPN_WCNPO_OSDWLL_early_Area2.png" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;7: Fit to the S3 Japanese early area 2 LL CPUE index. Left is the input CPUE with CV and the model fit CPUE (blue line). Right is the annual residuals of that fit.</figcaption><p></p>
</figure>
</div>
<div id="fig-8" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index5_logcpuefit_S4_JPN_WCNPO_OSDWLL_late_Area2.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index10_resids_SE_total_S4_JPN_WCNPO_OSDWLL_late_Area2.png" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;8: Fit to the S4 Japanese late area 2 LL CPUE index. Left is the input CPUE with CV and the model fit CPUE (blue line). Right is the annual residuals of that fit.</figcaption><p></p>
</figure>
</div>
<div id="fig-9" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index5_logcpuefit_S5_TWN_WCNPO_DWLL_late.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index10_resids_SE_total_S5_TWN_WCNPO_DWLL_late.png" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;9: Fit to the S5 Chinese Taipei late LL CPUE index. Left is the input CPUE with CV and the model fit CPUE (blue line). Right is the annual residuals of that fit.</figcaption><p></p>
</figure>
</div>
<div id="fig-10" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index5_logcpuefit_S6_US_WCNPO_LL_deep.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index10_resids_SE_total_S6_US_WCNPO_LL_deep.png" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;10: Fit to the S6 US deep-set LL CPUE recruitment index. Left is the input CPUE with CV and the model fit CPUE (blue line). Right is the annual residuals of that fit.</figcaption><p></p>
</figure>
</div>
<div id="fig-11" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index5_logcpuefit_S7_US_WCNPO_LL_shallow_early.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index10_resids_SE_total_S7_US_WCNPO_LL_shallow_early.png" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;11: Fit to the S7 US shallow-set LL early CPUE index. Left is the input CPUE with CV and the model fit CPUE (blue line). Right is the annual residuals of that fit.</figcaption><p></p>
</figure>
</div>
<div id="fig-12" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index5_logcpuefit_S8_US_WCNPO_LL_shallow_late.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/index10_resids_SE_total_S8_US_WCNPO_LL_shallow_late.png" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;12: Fit to the S8 US shallow-set LL early CPUE index. Left is the input CPUE with CV and the model fit CPUE (blue line). Right is the annual residuals of that fit.</figcaption><p></p>
</figure>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-13" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Sculley_AssessmentWP_files/figure-html/fig-13-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;13: Results from a runs test for each CPUE index. Red indicates the index failed the test (residuals are not random), green indicates the index passed the test.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Estimated selectivity for each fleet are in . Fits to the length composition data were also relatively good (<a href="#fig-17">Figure&nbsp;17</a> - <a href="#fig-20">Figure&nbsp;20</a>), although there are still problems fitting the US deep-set longline data (F9). &nbsp;The fit to the US size data is challenging because size distribution changes substantially seasonally, with a sharp peak of small fish entering the fishery in quarters 3 and 4 which are not observed in such large numbers in quarters 1 and 2. Attempts to separate the fleet into a quarterly fleets to estimate selectivity are ongoing but not yet successful. In addition, F1 JPN LL area 1 late and F4 IATTC both fail the runs test (<a href="#fig-21">Figure&nbsp;21</a>).</p>
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit__aggregated_across_time.png" class="img-fluid" alt="Aggregated Size comp data (grey) and model fit (green)">{<strong>?@fig-14</strong>}</p>
<div id="fig-15" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="ModelDev/Current%20Best/plots/sel03_len_timevary_surf_flt1sex1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;14: Time-varying selectivity estimated for F01 Japan LL area 1 late.</figcaption><p></p>
</figure>
</div>
<div id="fig-16" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="ModelDev/Current%20Best/plots/sel03_len_timevary_surf_flt2sex1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;15: Time-varying selectivity estimated for F02 Chinese Taipei LL late.</figcaption><p></p>
</figure>
</div>
<div id="fig-17" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ModelDev/Current%20Best/plots/sel09_len_flt3sex1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">F03_US_WCNPO_LL_shallow_late</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ModelDev/Current%20Best/plots/sel09_len_flt4sex1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">F04_IATTC</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ModelDev/Current%20Best/plots/sel09_len_flt6sex1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">F06_JPN_WCNPO_OSDWLL_early_Area1</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ModelDev/Current%20Best/plots/sel09_len_flt7sex1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">F07_JPN_WCNPO_CODF</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ModelDev/Current%20Best/plots/sel09_len_flt8sex1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">F08_US_WCNPO_LL_shallow_early</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ModelDev/Current%20Best/plots/sel09_len_flt9sex1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">F09_US_WCNPO_LL_deep</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;16: Selectivity estimates for each of the 6 fleets without time-varying parameters.</figcaption><p></p>
</figure>
</div>
<div id="fig-17" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_data_weighting_TA1.8_F1_JPN_WCNPO_OSDWCOLL_late_Area1.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_residsflt1mkt0_page5.png" class="img-fluid figure-img"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_data_weighting_TA1.8_F2_TWN_WCNPO_DWLL_late.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_residsflt2mkt0_page3.png" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;17: Fits to the annual mean length (left panels) and quarterly residuals (right panels) for Japan LL Area 1 late (top) and Chinese Taipei LL late (bottom) length composition data. The blue line indicates the estimated mean length, open dots indicate input mean length with black bars indicating the distribution of the length data with the added variance. Open circles indicate negative residuals and closed circles indicate positive residuals.</figcaption><p></p>
</figure>
</div>
<div id="fig-18" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_data_weighting_TA1.8_F3_US_WCNPO_LL_shallow_late.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_residsflt3mkt0_page3.png" class="img-fluid figure-img"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_data_weighting_TA1.8_F4_IATTC.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_residsflt4mkt0_page2.png" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;18: Fits to the annual mean length (left panels) and quarterly residuals (right panels) for US shallow-set LL late (top) and IATTC EPO (bottom) length composition data. The blue line indicates the estimated mean length, open dots indicate input mean length with black bars indicating the distribution of the length data with the added variance. Open circles indicate negative residuals and closed circles indicate positive residuals.</figcaption><p></p>
</figure>
</div>
<div id="fig-19" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_data_weighting_TA1.8_F6_JPN_WCNPO_OSDWLL_early_Area1.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_residsflt6mkt0.png" class="img-fluid figure-img"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_data_weighting_TA1.8_F7_JPN_WCNPO_CODF.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_residsflt7mkt0_page2.png" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;19: Fits to the annual mean length (left panels) and quarterly residuals (right panels) for Japan LL Area 1 early (top) and Japan coastal driftnet (bottom) length composition data. The blue line indicates the estimated mean length, open dots indicate input mean length with black bars indicating the distribution of the length data with the added variance. Open circles indicate negative residuals and closed circles indicate positive residuals.</figcaption><p></p>
</figure>
</div>
<div id="fig-20" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_data_weighting_TA1.8_F8_US_WCNPO_LL_shallow_early.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_residsflt8mkt0.png" class="img-fluid figure-img"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_data_weighting_TA1.8_F9_US_WCNPO_LL_deep.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="ModelDev/Current%20Best/plots/comp_lenfit_residsflt9mkt0_page4.png" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;20: Fits to the annual mean length (left panels) and quarterly residuals (right panels) for US shallow-set LL early (top) and US deep-set LL (bottom) length composition data. The blue line indicates the estimated mean length, open dots indicate input mean length with black bars indicating the distribution of the length data with the added variance. Open circles indicate negative residuals and closed circles indicate positive residuals.</figcaption><p></p>
</figure>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Warning: combining data from multiple seasons</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-21" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Sculley_AssessmentWP_files/figure-html/fig-21-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;21: Results from a runs test for each size composition time series. Red indicates the time series failed the test (residuals are not random), green indicates the time series passed the test.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Model estimates of age 1+ biomass show a general increase in biomass from through the entire assessment time horizon, with some periodic dips in abundance (<a href="#fig-22">Figure&nbsp;22</a>). Initial spawning stock biomass was estimated to be approximately 4,200 mt and virgin SSB was around 25,000 mt (<a href="#fig-23">Figure&nbsp;23</a>). Annual fishing mortality is reported as the average for fish ages 1-10 (<a href="#fig-24">Figure&nbsp;24</a>). Fishing mortality was above MSY for all except 6 years and excepting 2015, has been below F<sub>MSY</sub> since 2014. Recruitment deviations suggested three periods of recruitment: high recruitment from 1975 to 1993, a period with little data and large variability around the estimates, average recruitment from 1994 to 2003 where recruitment varied around equilibrium recruitment, and low recruitment from 2004 to 2020. The log of the deviations were generally between 0.6 and -0.6 (<a href="#fig-25">Figure&nbsp;25</a>). Current depletion, as estimated as the age 1+ biomass in 2020 compared to the virgin age 1+ biomass was estimated to be 0.09.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-22" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Sculley_AssessmentWP_files/figure-html/fig-22-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;22: Estimated biomass (mt) of NP swordfish 1+ from the base-case model.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-23" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Sculley_AssessmentWP_files/figure-html/fig-23-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;23: Estimated NP swordfish Spawning Stock Biomass (SSB) from the with 95% confidence intervals. SSB<sub>MSY</sub> is indicated by the dashed green line.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-24" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Sculley_AssessmentWP_files/figure-html/fig-24-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;24: Estimated annual fishing mortality (average ages 1-10) the with 95% confidence intervals. F<sub>MSY</sub> is indicated by the dashed green line.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-25" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Sculley_AssessmentWP_files/figure-html/fig-25-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;25: Estimated annual recruitment (thouseands of age-0 fish) with 95% confidence intervals.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="diagnostics">Diagnostics</h2>
<p>Profiling on R<sub>0</sub> showed that the recruitment estimates were highly influential in the model results, but there was relative agreement between the CPUE indices and the length composition data on the lower bound of R0 (<a href="#fig-26">Figure&nbsp;26</a> - <span class="citation" data-cites="fig28">@fig28</span>). The US data (CPUE and length comp) drive the model dynamics suggesting an ln(R<sub>0</sub>) below 6.0, and Chinese Taipei data and Japanese size composition data suggesting an ln(R<sub>0</sub>) around 7. Japanese CPUE data suggest an ln(R<sub>0</sub>) around 6.1` (Tables 4-5).</p>
<div id="fig-26" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="ModelDev/Current%20Best/plots/Overall_Likelihood.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;26: Likelihood profile over R0 for the base-case model: total likelihood (black circles), recruitment (blue triangles), length composition data (light blue crosses), and survey/CPUE indices (yellow x).</figcaption><p></p>
</figure>
</div>
<div id="fig-27" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="ModelDev/Current%20Best/plots/CPUE_Likelihood.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;27: Likelihood profile over R0 by CPUE index for the base-case model.</figcaption><p></p>
</figure>
</div>
<div id="fig-28" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="ModelDev/Current%20Best/plots/Size_Likelihood.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;28: Likelihood profile over R0 for each length composition time series for the base-case model.</figcaption><p></p>
</figure>
</div>
<p>Results from the ASPM model showed the same population trend as the full model during 1975-1993, which is the time period without any size composition data. After 1994, the ASPM biomass increases drastically and deviates completely from the base-case model (Figures 29 and 30). Further investigation running an ASPM with a single early and late index at a time indicates a similar pattern for all CPUE indices (Figure 31). The most likely explanation for this is that the population dynamics prior to 1994 are being driven by the two CPUE indices available (Figure 32). After 1994 catch decreases and CPUE for all fleets flattens out which would indicate that a stock is recovering. However, the size composition data indicate that the majority of the catch is juvenile fish. Continued removals of individuals before they have a chance to reproduce would continue to cause the stock to decline below MSY levels. This indicates that the size composition data are an integral component of the model, without which we would not have a full picture of the fishing effect on the stock.</p>
<div class="cell">

</div>
<p>The retrospective analysis indicates that a significant retrospective pattern exists for both biomass and fishing mortality (Mohn’s rho = 0.2 and -0.14, respectively, Figure 33). Generally, biomass is overestimated and fishing mortality is underestimated. Results of the hindcast with cross-validation indicate that of the four CPUE indices at the end of the assessment horizon, only Chinese Taipei had reasonable predictive ability (MASE = 0.9), with all other fleets MASE &gt; 1 (Figure 34). Comparing the predictive ability of the size composition data, two fleets had very good predictive ability (MASE &lt;0.5, F2 and F18), five had good predictive ability (MASE &lt;1 and &gt;0.5, F1, F4, F5, F6, F16) and one had poor predictive ability (MASE &lt;1, F14, Figure 35). F14 only had one datapoint in the analysis which likely explains why it had poor predictive ability.</p>
<div class="cell">

</div>
<div class="cell">

</div>
<p>The likelihood profile indicated that the US data componenets (CPUE and size composition data) are majority contributors to the likelihood. Attempts to downweight the US LL size composition data results in a model that fails to converge (due to a Hessian that is not positive definite). However, the ASPM models indicate that the US CPUE data suggest a similar trend as the other CPUE indices. To further explore the effect of the US data, models were run removing all US data except catch and fitting the parameters. While the models including the Japanese size data also failed to converge, the results for all the models indicated an estimated ln(Ro) between 6.2 and 6.4, and SSB<sub>zero</sub> between 12500 and 15500 metric tons (Table 6). This suggests that even though the US data is a significant contributor to the likelihood, the estimated population size would be similar without the data.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>